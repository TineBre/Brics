<!DOCTYPE html>
<html lang="sl">

<head>
    <title>The bricks</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body onload="init()">
    <canvas id="canvas" width="300" height="300"></canvas>
    <script>
        var x = 150;
        var y = 150;
        var dx = 2;
        var dy = 4;
        var ctx;
        var canvas;
        var WIDTH;
        var HEIGHT;
        var r = 10;
        var intervalId; // Define intervalId variable

        function init() {
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');
            WIDTH = canvas.width;
            HEIGHT = canvas.height;
            intervalId = setInterval(draw, 10); // Assign intervalId
            init_paddle(); // Call init_paddle function

            // Add event listeners for keydown and keyup events
            $(document).on("keydown", onKeyDown);
            $(document).on("keyup", onKeyUp);

            // Call init_mouse function to set up mouse events
            init_mouse();
        }

        function draw() {
            clear();
            circle(x, y, 10);
            //premik ploščice levo in desno
            if (rightDown) paddlex += 5;
            else if (leftDown) paddlex -= 5;
            rect(paddlex, HEIGHT - paddleh, paddlew, paddleh);

            if (x + dx > WIDTH - r || x + dx < 0 + r)
                dx = -dx;

            if (y + dy < 0 + r)
                dy = -dy;
            else if (y + dy > HEIGHT - r) {
                if (x > paddlex && x < paddlex + paddlew)
                    dy = -dy;
                else
                    clearInterval(intervalId); // Stop the animation
            }

            x += dx;
            y += dy;
        }

        function circle(x, y, r) {
            ctx.beginPath();
            ctx.arc(x, y, r, 0, Math.PI * 2, true);
            ctx.closePath();
            ctx.fill();
        }

        function rect(x, y, w, h) {
            ctx.beginPath();
            ctx.rect(x, y, w, h);
            ctx.closePath();
            ctx.fill();
        }

        function clear() {
            ctx.clearRect(0, 0, WIDTH, HEIGHT);
        }

        var paddlex;
        var paddleh;
        var paddlew;

        function init_paddle() {
            paddlex = WIDTH / 2;
            paddleh = 10;
            paddlew = 75;
        }

        var rightDown = false;
        var leftDown = false;

        //nastavljanje leve in desne tipke
        function onKeyDown(evt) {
            if (evt.which == 39)
                rightDown = true;
            else if (evt.which == 37) leftDown = true;
        }

        function onKeyUp(evt) {
            if (evt.which == 39)
                rightDown = false;
            else if (evt.which == 37) leftDown = false;
        }

        var canvasMinX;
        var canvasMaxX;

        function init_mouse() {
            canvasMinX = $("canvas").offset().left;
            canvasMaxX = canvasMinX + WIDTH;
        }

        function onMouseMove(evt) {
            var mouseX = evt.pageX - canvasMinX;
            if (mouseX > 0 && mouseX < WIDTH) {
                paddlex = mouseX - paddlew / 2;
            }
        }
        $(document).mousemove(onMouseMove);

    </script>
</body>

</html>